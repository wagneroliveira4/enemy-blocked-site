<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ENEMY BLOCKED â€” Seguro & Offline</title>
<style>
  :root{--bg:#f6f7fb;--card:#ffffff;--accent:#0b76ef}
  body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0;background:var(--bg);color:#111}
  .wrap{max-width:820px;margin:36px auto;padding:20px}
  .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(12,20,40,.06)}
  h1{margin:0 0 8px;font-size:20px}
  label{display:block;margin-top:12px;font-size:13px;color:#334}
  .row{display:flex;gap:12px;align-items:center}
  input[type=range]{width:100%}
  input[type=text]{width:100%;padding:10px;border-radius:8px;border:1px solid #ddd}
  .controls{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;margin-top:8px}
  .btn{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer}
  .btn.secondary{background:#eee;color:#111}
  .result{font-family:monospace;display:flex;gap:8px;align-items:center;margin-top:12px}
  .chip{background:#f3f6ff;padding:8px;border-radius:8px;border:1px solid #e7edff;flex:1}
  .meta{margin-top:10px;font-size:13px;color:#556}
  footer{margin-top:14px;font-size:12px;color:#667}
  .strength{height:10px;border-radius:6px;background:#eee;overflow:hidden;margin-top:8px}
  .strength > i{display:block;height:100%}
  /* --- seÃ§Ã£o doaÃ§Ã£o --- */
  .donate{margin-top:40px;text-align:center;background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.05)}
  .donate img{max-width:200px;border:1px solid #ccc;border-radius:10px;margin:10px auto;display:block}
  .donate p{margin:6px 0;font-size:14px;color:#333}
  .donate small{color:#555}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ENEMY BLOCKED</h1>
      <p class="meta">Gera senhas no seu navegador usando RNG seguro (crypto). Nenhum dado Ã© enviado para servidor.</p>

      <label>Senha gerada</label>
      <div class="result">
        <div class="chip" id="password">â€” clique em Gerar â€”</div>
        <button class="btn" id="copyBtn">Copiar</button>
        <button class="btn secondary" id="downloadBtn">Baixar .txt</button>
      </div>

      <label>Tamanho: <span id="lenLabel">16</span> caracteres</label>
      <input type="range" id="length" min="4" max="64" value="16"/>

      <div class="controls">
        <label><input type="checkbox" id="lowercase" checked/> Letras minÃºsculas (a-z)</label>
        <label><input type="checkbox" id="uppercase" checked/> Letras maiÃºsculas (A-Z)</label>
        <label><input type="checkbox" id="numbers" checked/> NÃºmeros (0-9)</label>
        <label><input type="checkbox" id="symbols" checked/> SÃ­mbolos (!@#$%...)</label>
        <label><input type="checkbox" id="excludeAmbiguous"/> Excluir caracteres ambÃ­guos (0 O o 1 l I)</label>
        <label><input type="checkbox" id="pronounceable"/> Gerar passphrase (palavras) â€” modo simples</label>
      </div>

      <div style="display:flex;gap:12px;margin-top:12px">
        <button class="btn" id="generate">Gerar</button>
        <button class="btn secondary" id="clearBtn">Limpar</button>
      </div>

      <div class="meta" id="entropyLabel">Entropia: â€” bits Â· ForÃ§a: â€”</div>
      <div class="strength" aria-hidden>
        <i id="strengthBar" style="width:0%;background:linear-gradient(90deg,#ff4d4f,#ffb020,#3ddc84)"></i>
      </div>

      <footer>SugestÃ£o: use 12+ caracteres com vÃ¡rios tipos de caracteres. Para senhas de serviÃ§os importantes (bancos, e-mail) prefira gerador + gerenciador de senhas.</footer>
    </div>
    
    <p style="text-align:center; margin-top:10px; font-size:12px; color:#667;">Desenvolvido por <strong>Wagner C. de Oliveira</strong> ðŸ˜Ž</p>

    <div class="donate">
      <p>ðŸ’™ðŸ™ƒ <strong>Oi, se nosso Site te ajudou de alguma forma, por favor, doe R$1,00.<br>Assim podemos melhorar nosso serviÃ§o rsrsrs</strong> ðŸ˜Ž</p>
      <img src="QRCode site - Copia.jpg" alt="QR Code PIX">
      <p><small>Chave PIX: <b>eblocked.pix@gmail.com</b></small></p>
    </div>
  </div>

<script>
/* ==== Seu JS original permanece igual ==== */

/* ====== Charset definitions ====== */
const sets = {
  lower: 'abcdefghijklmnopqrstuvwxyz',
  upper: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
  numbers: '0123456789',
  symbols: '!@#$%^&*()-_=+[]{};:,.<>/?|~'
};
const ambiguous = 'O0oIl1';

/* ====== UI elements ====== */
const passwordEl = document.getElementById('password');
const lengthEl = document.getElementById('length');
const lenLabel = document.getElementById('lenLabel');
const generateBtn = document.getElementById('generate');
const copyBtn = document.getElementById('copyBtn');
const downloadBtn = document.getElementById('downloadBtn');
const entropyLabel = document.getElementById('entropyLabel');
const strengthBar = document.getElementById('strengthBar');
const clearBtn = document.getElementById('clearBtn');

lenLabel.textContent = lengthEl.value;

/* update length display */
lengthEl.addEventListener('input', () => {
  lenLabel.textContent = lengthEl.value;
});

/* Secure random integer in [0, max) without modulo bias using rejection sampling */
function secureRandomInt(max) {
  if (max <= 0) throw new Error('max must be > 0');
  const uint32Max = 0xffffffff;
  const view = new Uint32Array(1);
  const limit = Math.floor((uint32Max + 1) / max) * max; // largest multiple of max <= 2^32
  let r;
  do {
    crypto.getRandomValues(view);
    r = view[0];
  } while (r >= limit);
  return r % max;
}

/* generate password from charset */
function genPasswordFromCharset(len, charset) {
  if (!charset || charset.length === 0) return '';
  let out = '';
  const n = charset.length;
  for (let i = 0; i < len; i++) {
    const idx = secureRandomInt(n);
    out += charset[idx];
  }
  return out;
}

/* simple passphrase generator */
const smallWordlist = ("apple orange banana mango cherry grape lemon lime peach plum " +
"pear kiwi melon fig date berry").split(' ');
function genPassphrase(wordsCount=4) {
  const w = [];
  for (let i=0;i<wordsCount;i++){
    const idx = secureRandomInt(smallWordlist.length);
    w.push(smallWordlist[idx]);
  }
  return w.join('-');
}

/* entropy calculation */
function calcEntropyBits(poolSize, length) {
  if (poolSize <= 0 || length <= 0) return 0;
  return Math.log2(Math.pow(poolSize, length));
}

/* strength label from bits */
function strengthFromBits(bits) {
  if (bits < 28) return {label:'Muito fraca', pct:10};
  if (bits < 36) return {label:'Fraca', pct:30};
  if (bits < 60) return {label:'Moderada', pct:55};
  if (bits < 90) return {label:'Forte', pct:80};
  return {label:'Muito forte', pct:100};
}

/* build charset according to options */
function buildCharset(opts) {
  let charset = '';
  if (opts.pronounceable) return null;
  if (opts.lowercase) charset += sets.lower;
  if (opts.uppercase) charset += sets.upper;
  if (opts.numbers) charset += sets.numbers;
  if (opts.symbols) charset += sets.symbols;
  if (opts.excludeAmbiguous) {
    charset = charset.split('').filter(ch => !ambiguous.includes(ch)).join('');
  }
  charset = Array.from(new Set(charset)).join('');
  return charset;
}

/* main generate */
function generate() {
  const len = parseInt(lengthEl.value, 10) || 12;
  const opts = {
    lowercase: document.getElementById('lowercase').checked,
    uppercase: document.getElementById('uppercase').checked,
    numbers: document.getElementById('numbers').checked,
    symbols: document.getElementById('symbols').checked,
    excludeAmbiguous: document.getElementById('excludeAmbiguous').checked,
    pronounceable: document.getElementById('pronounceable').checked
  };

  let password = '';
  if (opts.pronounceable) {
    const words = Math.max(2, Math.round(len / 4));
    password = genPassphrase(words);
    var pool = 2000;
    var bits = Math.round(words * Math.log2(pool));
  } else {
    const charset = buildCharset(opts);
    if (!charset || charset.length === 0) {
      alert('Selecione pelo menos um tipo de caractere (ou ative passphrase).');
      return;
    }
    password = genPasswordFromCharset(len, charset);
    const pool = charset.length;
    var bits = Math.round(calcEntropyBits(pool, len));
  }

  passwordEl.textContent = password;
  const strength = strengthFromBits(bits);
  entropyLabel.textContent = `Entropia: ${bits} bits Â· ForÃ§a: ${strength.label}`;
  strengthBar.style.width = strength.pct + '%';
}

/* copy to clipboard */
copyBtn.addEventListener('click', async () => {
  const txt = passwordEl.textContent;
  if (!txt || txt.startsWith('â€”')) return;
  try {
    await navigator.clipboard.writeText(txt);
    copyBtn.textContent = 'Copiado!';
    setTimeout(()=>copyBtn.textContent='Copiar',900);
  } catch(e){
    alert('NÃ£o foi possÃ­vel copiar automaticamente. Selecione e copie manualmente.');
  }
});

/* download file */
downloadBtn.addEventListener('click', () => {
  const txt = passwordEl.textContent;
  if (!txt || txt.startsWith('â€”')) return;
  const blob = new Blob([txt+'\n'], {type:'text/plain;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'senha.txt';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
});

/* buttons */
generateBtn.addEventListener('click', generate);
clearBtn.addEventListener('click', () => {
  passwordEl.textContent = 'â€” clique em Gerar â€”';
  entropyLabel.textContent = 'Entropia: â€” bits Â· ForÃ§a: â€”';
  strengthBar.style.width='0%';
});

/* generate one on load */
generate();
</script>
</body>
</html>